<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KCI Case Tracker — Login</title>

<link rel="icon" type="image/x-icon" href="img/favicon.ico" />


<!-- Shared Theme Styles ---------->
<style>
:root {
  --bg:#0f1115;
  --panel:#151923;
  --panel-2:#1A1F2B;
  --border:#2a2f3a;
  --text:#e6ebf3;
  --muted:#9aa4b2;
  --accent:#4F8CF0;
  --radius:16px;
}

[data-theme="light"] {
  --bg:#f7f9fe;
  --panel:#ffffff;
  --panel-2:#f1f4fa;
  --border:#cfd6e4;
  --text:#10131a;
  --muted:#4a5568;
}

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font:15px system-ui, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card {
  background:var(--panel);
  padding:2rem;
  width:min(420px, 90%);
  border-radius:20px;
  border:1px solid var(--border);
  box-shadow:0 8px 24px rgba(0,0,0,.3);
}

h1 {
  text-align:center;
  margin-bottom:1.4rem;
}

/* Make ALL inputs identical width, same as password input */
.input {
  width: 100%;
  padding: .8rem;
  padding-right: 2.6rem; /* MATCH password field spacing */
  background: var(--panel-2);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 1rem;
  color: var(--text);
  box-sizing: border-box; /* prevents width mismatch */
}


.btn {
  width:100%;
  padding:.8rem;
  background:var(--accent);
  border:none;
  border-radius:12px;
  color:white;
  font-weight:600;
  cursor:pointer;
}
.btn:hover { filter:brightness(1.08); }

.link {
  text-decoration:underline;
  cursor:pointer;
  color:var(--muted);
  font-size:14px;
  margin-top:.5rem;
  display:block;
  text-align:center;
}

.tabs {
  display:flex;
  margin-bottom:1.2rem;
  background:var(--panel-2);
  border-radius:12px;
  padding:4px;
}

.tab {
  flex:1;
  text-align:center;
  padding:.6rem;
  border-radius:10px;
  cursor:pointer;
}
.tab.active {
  background:var(--accent);
  color:white;
}

.popup {
  position:fixed;
  bottom:20px;
  right:20px;
  background:var(--panel-2);
  border:1px solid var(--border);
  padding:1rem 1.2rem;
  border-radius:12px;
  z-index:999;
}

/* Input widths consistent */
.input,
.btn,
.password-wrap {
  width: 100%;
}
/* Ensure all input fields match button width perfectly */
.input-wrap {
  width: 100%;
}
.input-wrap .input {
  width: 100%;
}


/* Password field wrapper */
.password-wrap {
  position: relative;
  display: flex;
  align-items: center;
}

.password-wrap .input {
  padding-right: 2.6rem; /* space for icon */
}

/* Show / Hide text toggle */
.toggle-pass {
  position: absolute;
  right: 12px;
  transform: translateY(-50%);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  color: var(--muted);
  opacity: 0.9;
  user-select: none;
}

.toggle-pass:hover {
  opacity: 1;
  color: var(--text);
}

/* =========================================================
   GLOBAL CUSTOM SELECT (SITE-WIDE)
   ========================================================= */

select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  background-color: var(--panel-2);
  border: 1px solid var(--border);
  color: var(--text);

  padding: 0.55rem 2.2rem 0.55rem 0.9rem;
  border-radius: 10px;

  font: inherit;
  cursor: pointer;
  min-height: 38px;

  background-image:
    linear-gradient(45deg, transparent 50%, var(--muted) 50%),
    linear-gradient(135deg, var(--muted) 50%, transparent 50%);
  background-position:
    calc(100% - 16px) calc(50% - 3px),
    calc(100% - 10px) calc(50% - 3px);
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;

  transition: border-color .15s ease, background .15s ease;
}

/* Hover */
select:hover {
  background-color: var(--panel);
}

/* Focus */
select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(79,140,240,0.25);
}

/* Disabled */
select:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}

/* Compact select (tables) */
.status-select {
  padding: 0.35rem 1.8rem 0.35rem 0.6rem;
  border-radius: 8px;
  min-height: 32px;
}

/* =========================================================
   GLOBAL CUSTOM DATE PICKER
   ========================================================= */

input[type="date"] {
  appearance: none;
  -webkit-appearance: none;

  background-color: var(--panel-2);
  border: 1px solid var(--border);
  color: var(--text);

  padding: 0.5rem 0.9rem;
  border-radius: 10px;

  font: inherit;
  cursor: pointer;
  min-height: 38px;

  transition: border-color .15s ease, background .15s ease;
}

/* Hover */
input[type="date"]:hover {
  background-color: var(--panel);
}

/* Focus */
input[type="date"]:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(79,140,240,0.25);
}

/* Calendar icon (Chrome / Edge) */
input[type="date"]::-webkit-calendar-picker-indicator {
  filter: invert(0.85);
  cursor: pointer;
  opacity: 0.85;
}

/* Light theme fix */
[data-theme="light"] input[type="date"]::-webkit-calendar-picker-indicator {
  filter: invert(0.3);
}

/* Disabled */
input[type="date"]:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}

.date-wrap {
  display: flex;
  align-items: center;
  gap: .45rem;
}

.date-wrap span {
  display: grid;
  place-items: center;
  width: 34px;
  height: 34px;
  border-radius: 10px;
  background: var(--panel-2);
  border: 1px solid var(--border);
}


  
</style>
</head>

<body>

<div class="card">

  <h1>KCI Case Tracker</h1>

  <div class="tabs">
    <div id="tabLogin" class="tab active">Login</div>
    <div id="tabSignup" class="tab">Sign Up</div>
  </div>

  <!-- LOGIN FORM -->
  <div id="loginForm">
    <div class="input-wrap">
  <input id="loginEmail" class="input" placeholder="Email" type="email" />
</div>

    <div class="password-wrap">
  <input id="loginPassword" class="input" placeholder="Password" type="password" />
  <span class="toggle-pass" data-target="loginPassword">Show</span>
</div>

    <button id="btnLogin" class="btn">Login</button>
    <span id="forgot" class="link">Forgot Password?</span>
  </div>

  <!-- SIGNUP FORM -->
  <div id="signupForm" style="display:none;">
    <div class="input-wrap">
  <input id="signFirst" class="input" placeholder="First Name" />
</div>

<div class="input-wrap">
  <input id="signLast" class="input" placeholder="Last Name" />
</div>

<div class="input-wrap">
  <input id="signEmail" class="input" placeholder="Email" type="email" />
</div>

    <div class="password-wrap">
  <input id="signPassword" class="input" placeholder="Password" type="password" />
  <span class="toggle-pass" data-target="signPassword">Show</span>
</div>

    <button id="btnSignup" class="btn">Sign Up</button>
  </div>

</div>

<script type="module">
import { signup, login, resetPassword, watchAuth } from "./js/auth.js";
import { initUserProfile } from "./js/userProfile.js";
import { showPopup } from "./js/utils.js";

// Tabs
const tabLogin = document.getElementById("tabLogin");
const tabSignup = document.getElementById("tabSignup");
const loginForm = document.getElementById("loginForm");
const signupForm = document.getElementById("signupForm");

tabLogin.onclick = () => {
  tabLogin.classList.add("active");
  tabSignup.classList.remove("active");
  loginForm.style.display = "block";
  signupForm.style.display = "none";
};

tabSignup.onclick = () => {
  tabSignup.classList.add("active");
  tabLogin.classList.remove("active");
  loginForm.style.display = "none";
  signupForm.style.display = "block";
};

// AUTO-REDIRECT IF LOGGED IN
watchAuth((user) => {
  if (user && user.status === "approved") {
    if (user.role === "primary" || user.role === "secondary") {
      location.href = "admin.html";
    } else {
      location.href = "index.html";
    }
  }
});

// LOGIN
document.getElementById("btnLogin").onclick = async () => {
  const email = loginEmail.value.trim();
  const pass = loginPassword.value.trim();

  try {
    const user = await login(email, pass);
    showPopup("Login successful!");
  } catch (err) {
  switch (err.code) {
    case "auth/wrong-password":
      showPopup("Wrong password. Please try again.");
      break;

    case "auth/user-not-found":
      showPopup("User ID does not exist.");
      break;

    case "auth/user-disabled":
      showPopup("Your account has been disabled.");
      break;

    case "auth/too-many-requests":
      showPopup("Too many failed attempts. Try again later.");
      break;

    default:
      // covers pending user or unexpected auth errors
      if (err.message?.toLowerCase().includes("pending")) {
        showPopup("Your account is pending approval.");
      } else {
        showPopup("Login failed. Please check your credentials.");
      }
  }
}

};

// SIGNUP
document.getElementById("btnSignup").onclick = async () => {
  const first = signFirst.value.trim();
  const last = signLast.value.trim();
  const email = signEmail.value.trim();
  const pass = signPassword.value.trim();

  if (!first || !last || !email || !pass) {
    showPopup("Please fill all fields.");
    return;
  }

  try {
    await signup(first, last, email, pass);
    showPopup("Account created. Waiting for admin approval.");
    tabLogin.click();
  } catch (err) {
  switch (err.code) {
    case "auth/email-already-in-use":
      showPopup("An account with this email already exists.");
      break;

    case "auth/invalid-email":
      showPopup("Please enter a valid email address.");
      break;

    case "auth/weak-password":
      showPopup("Password must be at least 6 characters.");
      break;

    default:
      showPopup("Signup failed. Please try again.");
  }
}
};

// FORGOT PASSWORD
document.getElementById("forgot").onclick = async () => {
  const email = prompt("Enter your email:");
  if (!email) return;

  try {
    await resetPassword(email);
    showPopup("Password reset link sent.");
  } catch (err) {
  if (err.code === "auth/user-not-found") {
    showPopup("User ID does not exist.");
  } else {
    showPopup("Unable to send reset email. Try again later.");
  }
}

};

// SIMPLE SHOW / HIDE TEXT TOGGLE
document.querySelectorAll(".toggle-pass").forEach(el => {
  el.addEventListener("click", () => {
    const input = document.getElementById(el.dataset.target);

    if (input.type === "password") {
      input.type = "text";
      el.textContent = "Hide";
    } else {
      input.type = "password";
      el.textContent = "Show";
    }
  });
});

  // ENTER KEY — Trigger Login or Signup
document.addEventListener("keydown", (e) => {
  // Ignore if Enter pressed while focusing toggle-pass
  if (e.key === "Enter" && !e.target.classList.contains("toggle-pass")) {

    // If Login tab is active → trigger login button
    if (tabLogin.classList.contains("active")) {
      document.getElementById("btnLogin").click();
    }

    // If Signup tab is active → trigger signup button
    else if (tabSignup.classList.contains("active")) {
      document.getElementById("btnSignup").click();
    }
  }
});

  
</script>

</body>

</html>


















